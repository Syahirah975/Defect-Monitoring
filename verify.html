<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Verify Defect</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #020617;
  color: #e5e7eb;
  padding: 20px;
}
h1 { color: #22c55e; }
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #1f2937;
  padding: 6px;
  font-size: 12px;
  text-align: center;
}
th {
  background: #111827;
}
input.day-input {
  width: 30px;
  text-align: center;
  background: #111827;
  color: white;
  border: 1px solid #1f2937;
}
.green {
  background-color: #16a34a !important;
  color: white !important;
}
.red {
  background-color: #dc2626 !important;
  color: white !important;
}
a {
  color: #93c5fd;
}
img {
  display: block;
  margin: 2px auto;
  max-width: 50px;
}
</style>
</head>

<body>

<h1>✅ Verify Defect (PIC)</h1>
<p><a href="submit.html">← Back to Submit Page</a></p>

<table>
<thead>
<tr>
<th>No</th>
<th>Date</th>
<th>Line</th>
<th>Station</th>
<th>Description</th>
<th>Photo</th>
<th>Reject By</th>
<th>Day 1</th>
<th>Day 2</th>
<th>Day 3</th>
<th>Day 4</th>
<th>Day 5</th>
<th>Day 6</th>
<th>Day 7</th>
<th>Day 8</th>
<th>Day 9</th>
<th>Day 10</th>
<th>Day 11</th>
<th>Day 12</th>
<th>Day 13</th>
<th>Day 14</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const KEY = "defect_database";

function getData() {
  return JSON.parse(localStorage.getItem(KEY)) || [];
}

function saveData(data) {
  localStorage.setItem(KEY, JSON.stringify(data));
}

// Apply color for a day input
function applyColor(input) {
  input.classList.remove("green", "red");
  if (input.value === "0") input.classList.add("green");
  else if (input.value) input.classList.add("red");
}

// update day value and color
function updateDay(index, dayIndex) {
  const input = document.getElementById(`day-${index}-${dayIndex}`);
  const data = getData();
  data[index].days[dayIndex] = input.value.trim();
  saveData(data);
  applyColor(input);
}

// render table
function render() {
  const data = getData();
  const body = document.getElementById("tableBody");
  body.innerHTML = "";

  data.forEach((d, i) => {
    if (!d.days) d.days = Array(14).fill("");

    const row = document.createElement("tr");
    let dayColumns = "";

    d.days.forEach((val, dayIndex) => {
      dayColumns += `<td><input class="day-input" id="day-${i}-${dayIndex}" value="${val}" oninput="updateDay(${i}, ${dayIndex})"></td>`;
    });

    row.innerHTML = `
      <td>${d.no}</td>
      <td>${d.date}</td>
      <td>${d.line}</td>
      <td>${d.station}</td>
      <td><pre style="white-space: pre-wrap;">${d.description}</pre></td>
      <td>${d.photo ? `<a href="${d.photo}" target="_blank"><img src="${d.photo}"></a>` : "No Photo"}</td>
      <td>${d.rejectBy}</td>
      ${dayColumns}
    `;

    body.appendChild(row);

    // Apply colors immediately after adding row
    d.days.forEach((_, dayIndex) => {
      const input = document.getElementById(`day-${i}-${dayIndex}`);
      applyColor(input);
    });
  });
}

render();
</script>

</body>
</html>
